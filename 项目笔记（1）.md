## 后端 shop-api

1.将数据库改为 “shop_db_无数据.sql”

2.app.js 权限打开

```js
// 如果想被登录拦截器拦截判断的, 接口放到下面
// app.use(async (req, res, next) => {
//     if (!req.headers.authorization) {
//         res.send(MError("请设置请求头,并携带验证字符串"));
//     } else {
//         if (!await checkToken(req)) { // 过期  
//             res.send(Guest([],"登录已过期或访问权限受限"));
//         } else {
//             next();
//         }
//     }
// });
//后台管理相关接口
```

3.启动

```js
npm start //localhost:3000
```

## 前端

### 1.创建项目

### 2.清空操作

1.删除src/assets

2.删除src/components

3.router/index.js 删除了与helloword相关的

```js
import Vue from 'vue'
import Router from 'vue-router'
Vue.use(Router)

export default new Router({
  routes: [
   
  ]
})

```

4.重置app.vue

### 3.项目搭建

#### 3.1 assets

1.assets/css/reset.css

2.main.js引入

```js
// 1.reset.css
import "./assets/css/reset.css"
```

#### 3.2 状态层

1.安装

```
cnpm i  vuex --save
```

2.目录

```
-store 
	index.js
	actions.js
	mutations.js
	-modules
```

3.actions.js 根级别下的actions

```js
export let actions={}
```

4.mutations.js根级别下的state 、mutations、getters 

```js
export let state={}
export let getters={}
export let mutations={}
```

5.index.js 创建store并导出

```js
import Vue from "vue"
import Vuex from "vuex"
Vue.use(Vuex)

import {actions} from "./actions"
import {state,getters,mutations} from "./mutations"

export default new Vuex.Store({
    state,
    getters,
    mutations,
    actions,
    modules:{
        
    }
})
```

6.main.js引入 挂到根实例上

```js
// 2.vuex： 安装 目录 引入 挂到根实例
import store from "./store"

/* eslint-disable no-new */
new Vue({
  el: '#app',
    
 //挂到根实例
  store,
 
})

```

#### 3.3 数据交互

1.安装依赖包

```
cnpm i axios qs --save
```

2.配置代理 config/index.js

```js
proxyTable: {
      "/api":{
        target:"http://localhost:3000",
        changeOrigin:true,
        pathRewrite:{
          "^/api":"http://localhost:3000"
        }
      }
    },
```

3.utils/http.js

```js
import axios from "axios"
import qs from "qs"
import Vue from "vue"
//开发环境使用 8080
let baseUrl="/api"
Vue.prototype.$pre="http://localhost:3000"

//生产环境使用 打包
// let baseUrl=""
// Vue.prototype.$pre=""


//响应拦截
axios.interceptors.response.use(res=>{
    console.group("本次请求地址是："+res.config.url)
    console.log(res);
    console.groupEnd()
    return res
})
```

#### 3.4过滤器

1.filters/index.js

```js
import Vue from "vue"
```

2.,main.js引入

```js
// 4.过滤器
import "./filters"
```

#### 3.5公共组件

1.components/index.js

```js
import Vue from "vue"
```

2.,main.js引入

```js
// 5.公共组件
import "./components"
```

#### 3.6 路由组件配置 

1.创建pages

2.定义目录

```
-pages
	-home
		home.vue 路由组件
		-components 子组件们
			banner.vue
			
```

#### 3.7 UI库

1.安装依赖包

```
cnpm i element-ui --save
```

2.main.js引入

```js
// 7.element-ui:安装 引入
import ElementUI from 'element-ui';
import 'element-ui/lib/theme-chalk/index.css';
Vue.use(ElementUI);
```

### 4.一级路由搭建

##### 1.创建组件

pages下创建了login index

##### 2.定义路由出口（app.vue）

```vue
 <!-- 一级路由出口 -->
    <router-view></router-view>
```

##### 3.制定路由规则(router/index.js)

```js
routes: [
       {
         path:"/login",
         component:()=>import("../pages/login/login.vue")
       },
       {
        path:"/",
        component:()=>import("../pages/index/index.vue")
      },
  ]
```

### 5.login.vue 静态页

1.静态页

```vue
<template>
  <div class="login">
      <div class="con">
        <h3 class="center">登录</h3>
        <div class="ipt">
          <el-input v-model="user.name" placeholder="请输入账号" clearable></el-input>
        </div>
        <div class="ipt">
          <el-input v-model="user.pass" placeholder="请输入密码" clearable show-password></el-input>
        </div>
        <div class="center">
          <el-button type="primary" @click="login">登录</el-button>
        </div>
      </div>
  </div>
</template>

<script>
export default {
  data(){
    return {
      user:{
        name:"",
        pass:""
      }
    }
  },
  methods:{
    //登录
    login(){
      this.$router.push("/")
    }
  }
}
</script>
```

### 6.index.vue

1静态页 （element-ui上粘贴的）

```vue
<div>
    <el-container class="index">
      <el-aside width="200px">
        cebian
      </el-aside>
      <el-container>
        <el-header>Header</el-header>
        <el-main>Main</el-main>
      </el-container>
    </el-container>
  </div>
```

### 7.二级路由

1.创建组件

```
home 首页
menu 菜单
role 角色
manage 管理员管理
cate 商品分类
specs 商品规格
goods 商品管理
member 会员
banner 轮播图
seckill 秒杀
```

2.定义路由出口（index.vue）

```vue
<el-main>
    <!-- 二级路由出口 -->
    <router-view></router-view>
</el-main>
```

3.配置规则(router/index.js)

```js
{
      path: "/",
      component: () => import("../pages/index/index.vue"),
      children:[
        {
          path:"",
          component:()=>import("../pages/home/home.vue")
        },
        {
          path:"menu",
          component:()=>import("../pages/menu/menu.vue")
        },
        {
          path:"role",
          component:()=>import("../pages/role/role.vue")
        },
        {
          path:"manage",
          component:()=>import("../pages/manage/manage.vue")
        },
        {
          path:"cate",
          component:()=>import("../pages/cate/cate.vue")
        },
        {
          path:"specs",
          component:()=>import("../pages/specs/specs.vue")
        },
        {
          path:"goods",
          component:()=>import("../pages/goods/goods.vue")
        },
        {
          path:"member",
          component:()=>import("../pages/member/member.vue")
        },
        {
          path:"banner",
          component:()=>import("../pages/banner/banner.vue")
        },
        {
          path:"seckill",
          component:()=>import("../pages/seckill/seckill.vue")
        },
      ]
    },
```

### 8.侧边栏导航（index.vue）

```vue
<el-aside width="200px">
    <!-- 侧边栏 
    background-color 背景色
    text-color 文字的颜色
    active-text-color 激活的时候文字的颜色
    unique-opened	是否只保持一个子菜单的展开
    router 开启路由模式，index就是配置path
-->
    <el-menu
             class="el-menu-vertical-demo"
             background-color="#20222a"
             text-color="#fff"
             active-text-color="#ffd04b"
             unique-opened
             router
             >
        <el-menu-item index="/">
            <i class="el-icon-menu"></i>
            <span slot="title">首页</span>
        </el-menu-item>

        <el-submenu index="1">
            <template slot="title">
<i class="el-icon-location"></i>
<span>系统设置</span>
            </template>
            <el-menu-item-group>
                <el-menu-item index="/menu">菜单管理</el-menu-item>
                <el-menu-item index="/role">角色管理</el-menu-item>
                <el-menu-item index="/manage">管理员管理</el-menu-item>
            </el-menu-item-group>
        </el-submenu>
        <el-submenu index="3">
            <template slot="title">
                <i class="el-icon-location"></i>
                <span>商城管理</span>
            </template>
            <el-menu-item-group>
                <el-menu-item index="/cate">商品分类</el-menu-item>
                <el-menu-item index="/specs">商品规格</el-menu-item>
                <el-menu-item index="/goods">商品管理</el-menu-item>
                <el-menu-item index="/member">会员管理</el-menu-item>
                <el-menu-item index="/banner">轮播图管理</el-menu-item>
                <el-menu-item index="/seckill">秒杀活动</el-menu-item>
            </el-menu-item-group>
        </el-submenu>
    </el-menu>
</el-aside>
```

### 9.面包屑

1.router/index.js 给每一个加了一个name

```js
{
          path:"banner",
          component:()=>import("../pages/banner/banner.vue"),
          name:"轮播图管理"
        },
        {
          path:"seckill",
          component:()=>import("../pages/seckill/seckill.vue"),
          name:"秒杀活动"
        },
```

2.index.vue 使用面包屑

```vue
<el-main>
    <!-- 面包屑 -->
    <el-breadcrumb separator="/" v-if="$route.name">
        <el-breadcrumb-item :to="{ path: '/' }">首页</el-breadcrumb-item>
        <el-breadcrumb-item>{{$route.name}}</el-breadcrumb-item>
    </el-breadcrumb>
    <!-- 二级路由出口 -->
    <router-view></router-view>
</el-main>
```

### 10.菜单管理 (menu.vue)

#### 1.拆分组件和静态页

###### 1.menu.vue 拆分组件

```vue
<div>
    <!-- 1.拆分组件，并绘制静态页 -->
      <el-button type="primary">添加</el-button>

      <!-- 数据展示表格 -->
      <v-list></v-list>

      <!-- 添加弹框 -->
      <v-add></v-add>

  </div>
```

```js
import vList from "./components/list.vue"
import vAdd from "./components/add.vue"
export default {
  components:{
    vList,
    vAdd
  }
}
```

###### 2.list.vue 绘制静态页面

```vue
<template>
  <div>
     <!-- :tree-props="{children:'哪个字段用来判断有下一层'}" -->
    <el-table
      :data="tableData"
      style="width: 100%;margin-bottom: 20px;"
      row-key="id"
      border
      :tree-props="{children: 'child'}"
    >
      <el-table-column prop="date" label="菜单编号" sortable width="180"></el-table-column>
      <el-table-column prop="name" label="菜单名称" sortable width="180"></el-table-column>
      <el-table-column prop="name" label="菜单图标"></el-table-column>
      <el-table-column prop="name" label="菜单地址"></el-table-column>
      <el-table-column label="状态">
        <el-button type="primary">启用</el-button>
      </el-table-column>
      <el-table-column label="操作">
        <el-button type="primary">编辑</el-button>
        <el-button type="danger">删除</el-button>
      </el-table-column>
    </el-table>
  </div>
</template>

<script>
export default {
  data() {
    return {
      tableData: [
        {
          id: 1,
          date: "2016-05-02",
          name: "王小虎",
          address: "上海市普陀区金沙江路 1518 弄"
        },
        {
          id: 2,
          date: "2016-05-04",
          name: "王小虎",
          address: "上海市普陀区金沙江路 1517 弄"
        },
        {
          id: 3,
          date: "2016-05-01",
          name: "王小虎",
          address: "上海市普陀区金沙江路 1519 弄",
          child: [
            {
              id: 31,
              date: "2016-05-01",
              name: "王小虎",
              address: "上海市普陀区金沙江路 1519 弄",
              child: [
                {
                  id: 40,
                  date: "2016-05-01",
                  name: "王小虎",
                  address: "上海市普陀区金沙江路 1519 弄"
                }
              ]
            },
            {
              id: 32,
              date: "2016-05-01",
              name: "王小虎",
              address: "上海市普陀区金沙江路 1519 弄"
            }
          ]
        },
        {
          id: 4,
          date: "2016-05-03",
          name: "王小虎",
          address: "上海市普陀区金沙江路 1516 弄"
        }
      ]
    };
  }
};
</script>
```

###### 3.add.vue 绘制静态页

```vue
<template>
  <div>
    <el-dialog title="添加菜单" :visible.sync="isshow">
      <el-form :model="user">
        <el-form-item label="菜单名称" label-width="100px">
          <el-input v-model="user.name" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="上级菜单" label-width="100px">
          <el-select v-model="user.name">
            <el-option>顶级菜单</el-option>
            <el-option>系统设置</el-option>
            <el-option>商城管理</el-option>
          </el-select>
        </el-form-item>
        <el-form-item label="菜单类型" label-width="100px">
          <el-radio v-model="user.name">目录</el-radio>
          <el-radio v-model="user.name">菜单</el-radio>
        </el-form-item>
        <el-form-item label="菜单图标" label-width="100px">
          <el-select v-model="user.name">
            <el-option>
              <i class="el-icon-setting"></i>
            </el-option>
            <el-option>
              <i class="el-icon-user-solid"></i>
            </el-option>
            <el-option>
              <i class="el-icon-camera-solid"></i>
            </el-option>
          </el-select>
        </el-form-item>
        <el-form-item label="菜单地址" label-width="100px">
          <el-select v-model="user.name">
            <el-option>
              <i class="el-icon-setting"></i>
            </el-option>
            <el-option>
              <i class="el-icon-user-solid"></i>
            </el-option>
            <el-option>
              <i class="el-icon-camera-solid"></i>
            </el-option>
          </el-select>
        </el-form-item>

        <el-form-item label="状态" label-width="100px">
          <el-switch v-model="user.name" ></el-switch>
        </el-form-item>
      </el-form>
      <div slot="footer" class="dialog-footer">
        <el-button @click="isshow = false">取 消</el-button>
        <el-button type="primary">添 加</el-button>
        <el-button type="primary">修 改</el-button>
      </div>
    </el-dialog>
  </div>
</template>

<script>
export default {
  data() {
    return {
      isshow: true,
      user: {
        name: ""
      }
    };
  }
};
</script>
```

#### 2.弹框状态 （2-6）

1.menu.vue

```js
//2.弹框状态
      info:{
        isshow: false
      },
```

```vue
 <!-- 3.传递info -->
<v-add :info="info"></v-add>
```

2.add.vue

```js
 // 4.接收info
  props: ["info"],
```

3.add.vue 使用

```vue
<el-dialog title="添加菜单" :visible.sync="info.isshow">
</el-dialog>
```

4.取消 add.vue

```vue
<el-button @click="cancel">取 消</el-button>
```

```js
//6.点了取消
cancel() {
    this.info.isshow = false;
},
```

#### 3.菜单添加

1.http.js

```js
//7.添加
export const reqMenuAdd=(user)=>{
    return axios({
        url:baseUrl+"/api/menuadd",
        method:"post",
        data:qs.stringify(user)
    })
}
```

2.add.vue 

```js
 data() {
    return {
      //8.初始化user
      user: {
        pid: 0,
        title: "",
        icon: "",
        type: 1,
        url: "",
        status: 1
      },
      //9.icon集合
      icons: [
        "el-icon-setting",
        "el-icon-user-solid",
        "el-icon-camera-solid",
        "el-icon-s-platform",
        "el-icon-s-order"
      ],
      //13.路由集合
      indexRoutes
    };
```

3.router/index.js

```js
//11.导出二级路由
export let indexRoutes=[
  {
    path:"menu",
    component:()=>import("../pages/menu/menu.vue"),
    name:"菜单管理"
  },
  {
    path:"role",
    component:()=>import("../pages/role/role.vue"),
    name:"角色管理"
  },
  {
    path:"manage",
    component:()=>import("../pages/manage/manage.vue"),
    name:"管理员管理"
  },
  {
    path:"cate",
    component:()=>import("../pages/cate/cate.vue"),
    name:"商品分类"
  },
  {
    path:"specs",
    component:()=>import("../pages/specs/specs.vue"),
    name:"商品规格"
  },
  {
    path:"goods",
    component:()=>import("../pages/goods/goods.vue"),
    name:"商品管理"
  },
  {
    path:"member",
    component:()=>import("../pages/member/member.vue"),
    name:"会员管理"
  },
  {
    path:"banner",
    component:()=>import("../pages/banner/banner.vue"),
    name:"轮播图管理"
  },
  {
    path:"seckill",
    component:()=>import("../pages/seckill/seckill.vue"),
    name:"秒杀活动"
  },
]
```

```js
	{
      path: "/",
      component: () => import("../pages/index/index.vue"),
      children:[
        {
          path:"",
          component:()=>import("../pages/home/home.vue")
        },
        //12.恢复
        ...indexRoutes
      ]
    },
```

4.add.vue  数据绑定到页面

```vue
 <!-- 14.数据绑定到页面 -->
      <el-form :model="user">
        <el-form-item label="菜单名称" label-width="100px">
          <el-input v-model="user.title" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="上级菜单" label-width="100px">
          <el-select v-model="user.pid">
            <el-option :value="0" label="顶级菜单"></el-option>
            <!-- 需要一段数据 -->
            <el-option v-for="item in list" :key="item.id" :value="item.id" :label="item.title"></el-option>
          </el-select>
        </el-form-item>
        <el-form-item label="菜单类型" label-width="100px">
          <el-radio v-model="user.type" :label="1">目录</el-radio>
          <el-radio v-model="user.type" :label="2">菜单</el-radio>
        </el-form-item>
        <el-form-item label="菜单图标" label-width="100px">
          <el-select v-model="user.icon">
            <el-option v-for="item in icons" :key="item" :value="item">
              <i :class="item"></i>
            </el-option>
          </el-select>
        </el-form-item>
        <el-form-item label="菜单地址" label-width="100px">
          <el-select v-model="user.url">
            <el-option
              v-for="item in indexRoutes"
              :key="item.path"
              :value="'/'+item.path"
              :label="item.name+'-/'+item.path"
            ></el-option>
          </el-select>
        </el-form-item>
        <el-form-item label="状态" label-width="100px">
          <el-switch v-model="user.status" :active-value="1" :inactive-value="2"></el-switch>
        </el-form-item>
      </el-form>
```

5.点了添加

```vue
 <el-button type="primary" @click="add">添 加</el-button>
```

```js
//清空user
    empty() {
      this.user = {
        pid: 0,
        title: "",
        icon: "",
        type: 1,
        url: "",
        status: 1
      };
    },
    //15.添加
    add() {
      reqMenuAdd(this.user).then(res => {
        if (res.data.code == 200) {
          // 16.封装了成功弹框
          successalert(res.data.msg);
          //弹框消失
          this.cancel();
          //17.清空user
          this.empty();
          //25.列表刷新
          this.$emit("init")
        }
      });
    }
```

6。封装弹框 util/alert.js

```js
import Vue from "vue"
let vm=new Vue()

//成功
export let successalert = (msg) => {
    vm.$message({
        message: msg,
        type: "success"
    });
}
//错误
export let erroralert = msg => {
    vm.$message({
        message: msg,
        type: 'warning'
    });
}
```

7.处理失败 http.js

```js
axios.interceptors.response.use(res=>{
    console.group("本次请求地址是："+res.config.url)
    console.log(res);
    console.groupEnd()
    //18.统一处理失败
    if(res.data.code!==200){
        erroralert(res.data.msg)
    }
    return res
})
```

#### 4.菜单列表

1.http.js

```js
//19.列表
export let reqMenulist=()=>{
    return axios({
        url:baseUrl+"/api/menulist",
        params:{
            istree:true
        }
    })
}
```

2.menu.vue 初始化数据

```js
 //20.初始化列表数据
      list:[]
```

3.请求（menu.vue）

```js
methods: {
    
    //获取列表
    init(){
      reqMenulist().then(res=>{
      if(res.data.code==200){
        this.list=res.data.list
      }
    })
    }
  },
  mounted(){
    //21.获取list
    this.init()
  }
```

4.传给子组件 list(menu.vue)

```vue
 <!-- 22.传list -->
 <v-list :list="list"></v-list>
```

5.list.vue接收

```js
 //23.接收list
  props: ["list"],
```

```vue
<!-- 24.遍历list -->
    <!-- :tree-props="{children:'哪个字段用来判断有下一层'}" -->
    <el-table
      :data="list"
      style="width: 100%;margin-bottom: 20px;"
      row-key="id"
      border
      :tree-props="{children: 'children'}"
    >
      <el-table-column prop="id" label="菜单编号" sortable width="180"></el-table-column>
      <el-table-column prop="title" label="菜单名称" sortable width="180"></el-table-column>
      <el-table-column  label="菜单图标">
        <template slot-scope="scope">
           <i :class="scope.row.icon"></i>
        </template>
      </el-table-column>
      <el-table-column prop="url" label="菜单地址"></el-table-column>
      <el-table-column label="状态">
        <template slot-scope="scope">
          <el-button type="primary" v-if="scope.row.status===1">启用</el-button>
          <el-button type="info" v-else>禁用</el-button>
        </template>
      </el-table-column>
      <el-table-column label="操作">
        <template slot-scope="scope">
          <el-button type="primary">编辑</el-button>
          <el-button type="danger" >删除</el-button>
        </template>
      </el-table-column>
    </el-table>
  </div>
```

6.传递给add.vue 

```vue
    <!-- 26.绑定init -->
    <!-- 27.传list -->
    <v-add :info="info" @init="init" :list="list"></v-add>
```

7.add.vue

```js
// 28.收list
  props: ["info","list"],
```

```vue
<el-form-item label="上级菜单" label-width="100px">
          <el-select v-model="user.pid">
            <el-option :value="0" label="顶级菜单"></el-option>
            <!-- 需要一段数据 -->
            <el-option v-for="item in list" :key="item.id" :value="item.id" :label="item.title"></el-option>
          </el-select>
        </el-form-item>
```

8.添加完成 刷新list(add.vue)

```js
	//15.添加
    add() {
      reqMenuAdd(this.user).then(res => {
        if (res.data.code == 200) {
          // 16.封装了成功弹框
          successalert(res.data.msg);
          //弹框消失
          this.cancel();
          //17.清空user
          this.empty();
          //25.列表刷新
          this.$emit("init")
        }
      });
     }
```

#### 5.补充添加（add.vue）

1.目录有图标，菜单有地址

```vue
		
        <el-form-item label="菜单图标" label-width="100px" v-if="user.type==1">
          <el-select v-model="user.icon">
            ...
          </el-select>
        </el-form-item>
        <el-form-item label="菜单地址" label-width="100px" v-else>
          <el-select v-model="user.url">
           ...
          </el-select>
        </el-form-item>
```

2.如果选了”顶级菜单“,就是目录，否则，就是菜单

```vue
 <el-form-item label="上级菜单" label-width="100px">
          <el-select v-model="user.pid" @change="changePid">
            <el-option :value="0" label="顶级菜单"></el-option>
            <!-- 需要一段数据 -->
            <el-option v-for="item in list" :key="item.id" :value="item.id" :label="item.title"></el-option>
          </el-select>
        </el-form-item>
```

```js
//修改了顶级菜单
    changePid(){
      if(this.user.pid==0){
        this.user.type=1
      }else{
        this.user.type=2;
      }
    }
```

#### 6.删除 

1.http.js

```js
//30.删除
export let reqMenuDel=(obj)=>{
    return axios({
        url:baseUrl+"/api/menudelete",
        method:"post",
        data:qs.stringify(obj)
    })
}

```

2.list.vue 点了删除按钮

```vue
 <el-button type="danger" @click="del(scope.row.id)">删除</el-button>
```

```js
//31.删除
    del(id) {
      this.$confirm("你确定要删除吗?", "提示", {
        confirmButtonText: "删除",
        cancelButtonText: "取消",
        type: "warning"
      })
        .then(() => {
          //点了删除按钮
          reqMenuDel({ id: id }).then(res => {
            if(res.data.code===200){
              //弹弹框
              successalert(res.data.msg)
              //32.刷新list
              this.$emit("init")
            }
          });
        })
        .catch(() => {});
    },
```

#### 7.编辑 

1.http.js

```js
//38.一条数据
export let reqMenuDetail=(obj)=>{
    return axios({
        url:baseUrl+"/api/menuinfo",
        params:obj
    })
}
```

2.list.vue 点了编辑

```vue
<el-button type="primary" @click="edit(scope.row.id)">编辑</el-button>
```

```js
 //34.点了编辑按钮
    edit(id){
      //通知父组件有人点了编辑按钮
      this.$emit("edit",id)
    }
```

3.menu.vue

```vue
<!-- 35.绑定edit -->
<v-list :list="list" @init="init" @edit="edit($event)"></v-list>

<v-add  ref="add"></v-add>
```

```js
	//36.编辑触发
    edit(id){
      //弹框出现
      this.info.isshow=true;

      //触发add的getOne()
      this.$refs.add.getOne(id)
    }
```

4.add.vue 发请求

```js
//37.获取详情
    getOne(id){
      reqMenuDetail({id:id}).then(res=>{
        if(res.data.code==200){
          this.user=res.data.list
          //补id
          this.user.id=id;
        }
      })
    },
```

#### 8.修改

1.http.js

```js
//39.修改接口
export let reqMenuUpdate=(user)=>{
    return axios({
        url:baseUrl+"/api/menuedit",
        method:"post",
        data:qs.stringify(user)
    })
}
```

2.add.vue

```vue
<el-button type="primary" @click="update" v-else>修 改</el-button>
```

```js
//40修改
    update(){
      reqMenuUpdate(this.user).then(res=>{
        if(res.data.code==200){
          //弹成功
          successalert(res.data.msg)
          //弹框消失
          this.cancel()
          //数据清空
          this.empty()
          //刷新list
          this.$emit("init")
        }
      })
    }
```

#### 9.弹框是添加打开还是编辑打开

1.menu.vue

```js
 //2.弹框状态
      info: {
        isshow: false,
        //41.用来判断是添加还是编辑打开的摊弹框
        isadd:true
      },
```

```js
//5.点了添加按钮
    willAdd() {
      this.info.isshow = true;
      //42.是添加
      this.info.isadd=true
    },
```

```js
//36.编辑触发
    edit(id){
      //弹框出现
      this.info.isshow=true;

      //43.是编辑
      this.info.isadd=false

      //触发add的getOne()
      this.$refs.add.getOne(id)
    }
```

2.add.vue

```vue

    <el-dialog 
               :title="info.isadd?'添加菜单':'编辑菜单'" 
               :visible.sync="info.isshow"
               @closed="cancel"
    >
      <div slot="footer" class="dialog-footer">
        <el-button @click="cancel">取 消</el-button>
        <el-button type="primary" @click="add" v-if="info.isadd">添 加</el-button>
        <el-button type="primary" @click="update" v-else>修 改</el-button>
      </div>
    </el-dialog>
```

3.bug 编辑的时候清除数据

```vue
<el-dialog  @closed="cancel"> 
    </el-dialog>
```

```js
	 //6.点了取消
    cancel() {
      //45.编辑清空数据
      if(!this.info.isadd){
        this.empty()
      }
      this.info.isshow = false;
    },
```

### 11.角色管理

#### 1.拆分组件，绘制静态页

1.拆分组件 略

2.静态页 list 略 

树形控件

```vue
	<el-form-item label="角色权限" label-width="100px">
          <!-- 树形控件 
          data：展示的数据 
          show-checkbox：展示选择框
          node-key:每个树节点用来作为唯一标识的属性，整棵树应该是唯一的
          default-expanded-keys :默认展开
          default-checked-keys：默认选中
          :props="{children: '用来判断有没有下一个子节点的字段',label: '展示的内容的字段'}"
          -->
          <el-tree
            :data="[]"
            show-checkbox
            node-key="id"
            :props="{children: 'children',label: 'label'}"
          ></el-tree>
        </el-form-item>
```

#### 2.数据交互的接口

http.js

```js
/************角色管理 start**************************/

//添加
export let reqRoleAdd = (user) => {
    return axios({
        url: baseUrl + "/api/roleadd",
        method: "post",
        data: qs.stringify(user)
    })
}

//列表
export let reqRolelist = () => {
    return axios({
        url: baseUrl + "/api/rolelist",
    })
}

//详情 user={id:1}
export let reqRoleDetail = (user) => {
    return axios({
        url: baseUrl + "/api/roleinfo",
        method: "get",
        params: user
    })
}

//修改 user={id:"必填"}
export let reqRoleUpdate = (user) => {
    return axios({
        url: baseUrl + "/api/roleedit",
        method: "post",
        data: qs.stringify(user)
    })
}

//删除 user={id:1}
export let reqRoleDel = (user) => {
    return axios({
        url: baseUrl + "/api/roledelete",
        method: "post",
        data: qs.stringify(user)
    })
}



/************角色管理 end**************************/
```

#### 3.添加

1.add.vue

```js
 //1.树形控件的数据
      menuList:[],
```

```vue
 <el-tree
            :data="menuList"
            show-checkbox
            node-key="id"
            ref="tree"
            :props="{children: 'children',label: 'title'}"
          ></el-tree>
        </el-form-item>
```

2.请求菜单数据

```js
 mounted(){
    // 2.一进来就要获取菜单列表
    reqMenulist().then(res=>{
      if(res.data.code==200){
        this.menuList=res.data.list
      }
    })
  },
```

3.初始化user，通过v-model绑定在template

```js
	 //3.初始化user
      user: {
        rolename:"",
        menus:"",
        status:1
      },
```

4.点了添加

```js
 //4.添加
    add() {
      /*
      user的rolename、status是和表单关联的，所以这两个字段不用操作；
      但是menus和树形控件没有关联，在发起请求之前，需要将树形控件上选中的内容赋值给menus，
      再发请求。*/

      this.user.menus=JSON.stringify(this.$refs.tree.getCheckedKeys())
      
      reqRoleAdd(this.user).then(res => {
        if (res.data.code == 200) {
          // 封装了成功弹框
          successalert(res.data.msg);
          //弹框消失
          this.cancel();
          //5.清空user
          this.empty();
          //列表刷新
          this.$emit("init");
        }
      });
    },
```

empty

```js
	//清空user
    empty() {
      this.user = {
       rolename:"",
        menus:"",
        status:1
      };
      //树形控件要清空数据
      this.$refs.tree.setCheckedKeys([])
    },
```

#### 4.列表

1.role.vue 请求list

```js
init() {
      reqRolelist().then(res => {
        if (res.data.code == 200) {
         
          this.list = res.data.list;
        }
      });
    },
```

2.http.js 统一处理list是null的情况

```js
//响应拦截
axios.interceptors.response.use(res => {
    
    //18.统一处理失败
    if (res.data.code !== 200) {
        erroralert(res.data.msg)
    }
    //统一处理list是null的情况
    if(!res.data.list){
        res.data.list=[]
    }
    console.group("本次请求地址是：" + res.config.url)
    console.log(res);
    console.groupEnd()
    return res
})
```

#### 5.编辑

add.vue

```js
 getOne(id) {
      reqRoleDetail({ id: id }).then(res => {
        if (res.data.code == 200) {
          this.user = res.data.list;
          //补id
          this.user.id = id;
          //给树形控件赋值
          this.$refs.tree.setCheckedKeys(JSON.parse(this.user.menus))
        }
      });
    },
```

#### 6.修改

```js
 update() {
      //先取出树形控件的数据给menus，再发请求
      this.user.menus=JSON.stringify(this.$refs.tree.getCheckedKeys())
      reqRoleUpdate(this.user).then(res => {
        if (res.data.code == 200) {
          //弹成功
          successalert(res.data.msg);
          //弹框消失
          this.cancel();
          //数据清空
          this.empty();
          //刷新list
          this.$emit("init");
        }
      });
    }
```

#### 7.删除

1.由于很多组件都要做删除功能，所以提取一个公共组件delBtn

```vue
<template>
  <el-button type="danger" @click="del">删除</el-button>
</template>

<script>
export default {
  methods: {
    del() {
      this.$confirm("你确定要删除吗?", "提示", {
        confirmButtonText: "删除",
        cancelButtonText: "取消",
        confirmButtonClass:"el-button el-button--danger",
        type: "warning"
      })
        .then(() => {
           //用户点了确定，通知父组件该删了
           this.$emit("confirm")
            
        })
        .catch(() => {});
    }
  }
};
</script>
```

2.components/index.js 注册

```js
//删除组件
import delBtn from "./delBtn.vue"
Vue.component("delBtn",delBtn)
```

3.role/list.vue 调用

```vue
<del-btn @confirm="del(scope.row.id)"></del-btn>
```

```js
	//31.删除
    del(id) {
      reqRoleDel({ id: id }).then(res => {
        if (res.data.code == 200) {
          successalert(res.data.msg);
          this.$emit("init");
        }
      });
    },
```

### 12.管理员管理

#### 1.静态页 list.vue add.vue 略

#### 2.交互接口 http.js

```js
/************管理管理 start**************************/

//添加
export let reqManageAdd = (user) => {
    return axios({
        url: baseUrl + "/api/useradd",
        method: "post",
        data: qs.stringify(user)
    })
}

//列表 obj={page:1,size:50}
export let reqManagelist = (obj) => {
    return axios({
        url: baseUrl + "/api/userlist",
        method:"get",
        params:obj
    })
}

//详情 user={uid:123342}
export let reqManageDetail = (user) => {
    return axios({
        url: baseUrl + "/api/userinfo",
        method: "get",
        params: user
    })
}

//修改 user={uid:"必填"}
export let reqManageUpdate = (user) => {
    return axios({
        url: baseUrl + "/api/useredit",
        method: "post",
        data: qs.stringify(user)
    })
}

//删除 user={uid:13432}
export let reqManageDel = (user) => {
    return axios({
        url: baseUrl + "/api/userdelete",
        method: "post",
        data: qs.stringify(user)
    })
}
/************管理员管理 end**************************/
```

#### 3.添加 add.vue

1.初始化user

```js
//1.初始化user
      user: {
        roleid:"",
        username:"",
        password:"",
        status:1
      },
```

2.绑定数据

```vue
 <el-form-item label="所属角色" label-width="100px">
          <el-select v-model="user.roleid">
            <el-option label="--请选择--" value="" disabled></el-option>
            <!-- 5.遍历数据 -->
            <el-option v-for="item in roleList" :key="item.id" :label="item.rolename" :value="item.id"></el-option>
          </el-select>
        </el-form-item>
        <el-form-item label="用户名称" label-width="100px">
          <el-input v-model="user.username" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="密码" label-width="100px">
          <el-input v-model="user.password" autocomplete="off"></el-input>
        </el-form-item>

        

        <el-form-item label="状态" label-width="100px">
          <el-switch v-model="user.status" :active-value="1" :inactive-value="2"></el-switch>
        </el-form-item>
```

3.初始化角色列表

```js
//3.角色列表
      roleList:[],
```

4.请求角色

```js
 mounted(){
    // 4.一进来就要获取角色列表
    reqRolelist().then(res=>{
      if(res.data.code==200){
        this.roleList=res.data.list
      }
    })
  },
```

```vue
<el-select v-model="user.roleid">
            <el-option label="--请选择--" value="" disabled></el-option>
            <!-- 5.遍历数据 -->
            <el-option v-for="item in roleList" :key="item.id" :label="item.rolename" :value="item.id"></el-option>
          </el-select>
```

5.点了添加按钮

```js
 //清空user
    empty() {
      this.user = {
        roleid:"",
        username:"",
        password:"",
        status:1
      };
    },
    //4.添加
    add() {
      reqManageAdd(this.user).then(res => {
        if (res.data.code == 200) {
          // 封装了成功弹框
          successalert(res.data.msg);
          //弹框消失
          this.cancel();
          //5.清空user
          this.empty();
          //25.列表刷新
          this.$emit("init");
        }
      });
    },
```

#### 3.列表 manage.vue

```js
//获取列表
    init() {
      reqManagelist({page:1,size:50}).then(res => {
        if (res.data.code == 200) {
          this.list = res.data.list;
        }
      });
    },
```

#### 4.删除

list.vue

```vue
<del-btn @confirm="del(scope.row.uid)"></del-btn>
```

```js
 del(uid) {
      reqManageDel({ uid: uid }).then(res => {
        if (res.data.code == 200) {
          successalert(res.data.msg);
          this.$emit("init");
        }
      });
    },
```

#### 5.编辑

list.vue

```vue
 <el-button type="primary" @click="edit(scope.row.uid)">编辑</el-button>
```

add.vue

```js
  getOne(id) {
      reqManageDetail({ uid: id }).then(res => {
        if (res.data.code == 200) {
         this.user=res.data.list
         //密码置空
         this.user.password=""
        }
      });
    },
```

#### 6.修改

```js
update() {
      reqManageUpdate(this.user).then(res => {
        if (res.data.code == 200) {
          //弹成功
          successalert(res.data.msg);
          //弹框消失
          this.cancel();
          //数据清空
          this.empty();
          //刷新list
          this.$emit("init");
        }
      });
    }
```

#### 7.分页

1.mange.vue 调用分页组件

```vue
<!-- 一、分页
    prev表示上一页，
    next为下一页，
    pager表示页码列表
    total表示总条目数，默认一页10条
    page-size 每一页的数量
    current-change	currentPage 改变时会触发
     -->
    <el-pagination
    layout="prev, pager, next"
    :total="total"
    :page-size="pageSize"
    @current-change="changePage"
    >
  </el-pagination>
```

2.初始化数据

```js
 	// 二、初始值
      //一页的数量
      pageSize:2,
      //总数
      total:0,
      //当前页面
      page:1
```

3.一进来就要获取总数

http.js

```js
//总数
export let reqManageCount=()=>{
    return axios({
        url:baseUrl+"/api/usercount"
    })
}
```

manage.vue

```js
// 三、请求总数
    getTotal(){
      reqManageCount().then(res=>{
        if(res.data.code==200){
          this.total=res.data.list[0].total
        }
      })
    },

    //列表
    getList(){
      reqManagelist({page:this.page,size:this.pageSize}).then(res => {
        if (res.data.code == 200) {

          /*
          如果删除了最后一页的最后一条，那么当前页就会取到空数组；
          这个时候如果有上一页的话，就应该取上一页
          */
          if(res.data.list.length==0&&this.page>1){
            this.page--
            this.getList()
            return
          }

          this.list = res.data.list;
        }
      });
    },
   
    //获取列表
    init() {
      //四、获取总数
      this.getTotal();

      //获取列表
      this.getList()
    },
```

4.页码发生了修改

```vue
 <el-pagination
    
    @current-change="changePage"
    >
  </el-pagination>
```

```js
 // 五.修改了页码
    changePage(e){
      this.page=e;
      //再次取list
      this.getList()
    },

```

### 13.商品分类

#### 1.静态页 略

#### 2.数据交互

http.js

```js
// post 带有文件，参数转换
function dataToFormData(user){
    let data=new FormData()
    for(let i in user){
        data.append(i,user[i])
    }
    return data
}

//添加 user={img:File,catename:"12",pid:1}
export let reqcateAdd = (user) => {
    /*
    let data=new FormData()
    data.append("img",file)
    data.append("catename","123")
    data.append("pid",1)
    */ 
    /*
    let data=new FormData()
    for(let i in user){
        data.append(i,user[i])
    }*/

    return axios({
        url: baseUrl + "/api/cateadd",
        method: "post",
        data: dataToFormData(user)
    })
}

//列表 p={istree:true} {pid:1}
export let reqcatelist = (p) => {
    return axios({
        url: baseUrl + "/api/catelist",
        params:p
    })
}

//详情 user={id:1}
export let reqcateDetail = (user) => {
    return axios({
        url: baseUrl + "/api/cateinfo",
        method: "get",
        params: user
    })
}

//修改 user={id:"必填",img:file,catename:""}
export let reqcateUpdate = (user) => {
    return axios({
        url: baseUrl + "/api/cateedit",
        method: "post",
        data: dataToFormData(user)
    })
}

//删除 user={id:1}
export let reqcateDel = (user) => {
    return axios({
        url: baseUrl + "/api/catedelete",
        method: "post",
        data: qs.stringify(user)
    })
}

```

#### 3.添加

1.add.vue 初始化user

```js
 //3.初始化user
      user: {
        pid: "",
        catename: "",
        img:null,
        status: 1
      }
```

2.通过v-model绑定到页面

```vue
 <el-form :model="user">
        <el-form-item label="上级分类" label-width="100px">
          <el-select v-model="user.pid">
            <el-option value="" label="--请选择--" disabled></el-option>
            <el-option :value="0" label="顶级分类"></el-option>
            <!-- 少一个遍历 -->
          </el-select>
        </el-form-item>

        <el-form-item label="分类名称" label-width="100px">
          <el-input v-model="user.catename" autocomplete="off"></el-input>
        </el-form-item>

        <el-form-item label="图片" label-width="100px">
          <div></div>
        </el-form-item>

        <el-form-item label="状态" label-width="100px">
          <el-switch v-model="user.status" :active-value="1" :inactive-value="2"></el-switch>
        </el-form-item>
      </el-form>

```

3.绘制上传文件的静态页

```vue
 <el-form-item label="图片" label-width="100px">
          <!-- 一、原生js的上传文件 -->
          <div class="my-upload">
            <div class="add">+</div>
            <img v-if="imgUrl" class="img" :src="imgUrl" alt />
            <input type="file" class="ipt" @change="changeImg" />
          </div>
        </el-form-item>

        <el-form-item label="状态" label-width="100px">
          <el-switch v-model="user.status" :active-value="1" :inactive-value="2"></el-switch>
        </el-form-item>
      </el-form>
```

4.选择文件，触发input的change事件

```js
//上传文件
    changeImg(e) {
      let file = e.target.files[0];

      //文件大小验证 1M=1024KB 1KB=1024B
      if (file.size > 2 * 1024 * 1024) {
        erroralert("文件大小不能超过2M");
        return;
      }

      //后缀名
      //   let extname=file.name.slice(file.name.lastIndexOf("."));
      let extname = path.extname(file.name);
      let arr = [".png", ".gif", ".jpg", ".jpeg"];
      if (!arr.some(item => item === extname)) {
        erroralert("请上传图片");
        return;
      }

      // 将文件生成一个url地址
      this.imgUrl = URL.createObjectURL(file);

      //赋值给user.img
      this.user.img = file;
    },
```

5.添加

```js
 add() {
      reqcateAdd(this.user).then(res => {
        if (res.data.code == 200) {
          // 封装了成功弹框
          successalert(res.data.msg);
          //弹框消失
          this.cancel();
          //5.清空user
          this.empty();
          //25.列表刷新
          this.$emit("init");
        }
      });
    },

```

6.清空

```js
	//清空user
    empty() {
      this.imgUrl = "";
      //3.初始化user
      this.user = {
        pid: "",
        catename: "",
        img: null,
        status: 1
      };
    },
```

7.bug 添加成功，弹框消失，imgUrl也置空，但是input标签上的文件没有置空，如果想要input置空。需要input绑定v-if

```vue
<input v-if="info.isshow" type="file" class="ipt" @change="changeImg" />
```

8.上级分类遍历

```vue
<el-form-item label="上级分类" label-width="100px">
          <el-select v-model="user.pid">
            <el-option value label="--请选择--" disabled></el-option>
            <el-option :value="0" label="顶级分类"></el-option>
            <!-- 少一个遍历 -->
            <el-option v-for="item in list" :key="item.id" :value="item.id" :label="item.catename"></el-option>
          </el-select>
        </el-form-item>
```

9.图片是二级分类才添加 条件渲染

```vue
 <el-form-item label="图片" label-width="100px" v-if="user.pid!==0">
          <!-- 一、原生js的上传文件 -->
         
 </el-form-item>
```

#### 4.列表

cate.vue

```js
//获取列表
    init() {
      reqcatelist({istree:true}).then(res => {
        if (res.data.code == 200) {
         
          this.list = res.data.list;
        }
      });
    },
```

#### 5.删除

list.vue

```vue
<del-btn @confirm="del(scope.row.id)"></del-btn>
```

```js
 del(id) {
      reqcateDel({ id: id }).then(res => {
        if (res.data.code == 200) {
          successalert(res.data.msg);
          this.$emit("init");
        }
      });
    },
```

#### 6.编辑

```js
getOne(id) {
      reqcateDetail({ id: id }).then(res => {
        if (res.data.code == 200) {
          this.user = res.data.list;
          //补id
          this.user.id = id;
          //处理图片
          this.imgUrl=this.$pre+this.user.img
        }
      });
    },
```

#### 7.修改

```js
update() {
      reqcateUpdate(this.user).then(res => {
        if (res.data.code == 200) {
          //弹成功
          successalert(res.data.msg);
          //弹框消失
          this.cancel();
          //数据清空
          this.empty();
          //刷新list
          this.$emit("init");
        }
      });
    }
```

#### 8.element-ui上传文件

1.结构

```vue
 <el-upload
            class="avatar-uploader"
            action="#"
            :show-file-list="false"
            :on-change="changeImg2"
          >
            <img v-if="imgUrl" :src="imgUrl" class="avatar" />
            <i v-else class="el-icon-plus avatar-uploader-icon"></i>
          </el-upload>
```

2.修改了文件

```js
//ui上传文件
    changeImg2(e){
        let file=e.raw;
        //判断
        this.imgUrl=URL.createObjectURL(file)
        this.user.img=file;
    },
```

### 14.ui库样式修改不起作用

##### 1.important

```css
.el-upload {
  border: 1px dashed #d9d9d9 !important;
  border-radius: 6px;
  cursor: pointer;
  position: relative;
  overflow: hidden;
}
```

##### 2.stylus穿透

1.安装

```
cnpm i stylus stylus-loader@3.0.0 --save
```

2.修改语言

```vue
<style scoped lang="stylus"></style>
```

3.使用

```stylus
.form >>>.el-upload {
  border: 1px dashed #d9d9d9;
  border-radius: 6px;
  cursor: pointer;
  position: relative;
  overflow: hidden;
}
```

### 15.分类列表使用状态层

##### 1.store/modules/cate.js

```js
let state={
   
}
let mutations={}
let getters={}
let actions={}

export default {
    state,
    mutations,
    actions,
    getters,
    //命名空间
    namespaced:true
}
```

##### 2.store/index.js 引入 声明模块

```js
import cate from "./modules/cate"
export default new Vuex.Store({
    state,
    getters,
    mutations,
    actions,
    modules:{
        // 2.引入 注册
        cate,
        
    }
})
```

##### 3.设计状态list 修改 导出 以及逻辑处理

```js
import {reqcatelist} from "../../utils/http"
// 1.搭了架子
let state={
    // 3.1 初始值
    list:[]
}
let mutations={
    //3.2 修改list
    changeList(state,arr){
        state.list=arr;
    }
}
let getters={
    // 3.3 导出list
    list(state){
        return state.list;
    }
}
let actions={
    // 3.4 处理list的逻辑
    reqList(context){
        //发请求 成功之后 修改
        reqcatelist({istree:true}).then(res=>{
            if(res.data.code==200){
                context.commit("changeList",res.data.list)
            }
        })
    }
}

export default {
    state,
    mutations,
    actions,
    getters,
    //命名空间
    namespaced:true
}
```

##### 4.组件使用

```js
import {mapActions,mapGetters} from "vuex"
export default {
  
  computed:{
    ...mapGetters({
      "list":"cate/list"
    })
  },
  methods: {
    ...mapActions({
      "reqList":"cate/reqList"
    }),
  }
```

### 16.用户代码片段

1.编辑器左下角--》设置---》用户代码片段--》输入用户代码片段的名称-->回车

2.

```json
{
	// Place your umall_admin 工作区 snippets here. Each snippet is defined under a snippet name and has a scope, prefix, body and 
	// description. Add comma separated ids of the languages where the snippet is applicable in the scope field. If scope 
	// is left empty or omitted, the snippet gets applied to all languages. The prefix is what is 
	// used to trigger the snippet and the body will be expanded and inserted. Possible variables are: 
	// $1, $2 for tab stops, $0 for the final cursor position, and ${1:label}, ${2:another} for placeholders. 
	// Placeholders with the same ids are connected.
	// Example:
	"Print to console": {
		"scope": "javascript,typescript,vue",
		"prefix": "vue-0907",
		"body": [
			"<template>",
			"  <div></div>",
			"  </template>",

			"  <script>",
  "  import { mapActions, mapGetters } from \"vuex\";",
  "  export default {",
  "  data(){",
  "  return {}",
  "  },",
  "  computed: {",
  "  ...mapGetters({",
  "  list: \"cate/list\"",
  "  })",
  "  },",
  "  methods: {",
  "  ...mapActions({",
  "  reqList: \"cate/reqList\"",
  "  })",
  "  },",
  "  mounted() {}",
  "  };",
  "  </script>",
  "",
  "  <style scoped>",
  "  </style>"
		],
		"description": "Log output to console"
	}
}
```

